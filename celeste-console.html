<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Celeste – Console</title>

<link rel="icon" href="/images/favicon.svg" type="image/svg+xml" />

<style>
:root{
  --bg:#050811;
  --panel:rgba(255,255,255,0.04);
  --text:#e8ebef;
  --muted:#a0a8bb;
  --user:#f0f2f8;
  --assistant:#9bbcff;
  --line:#252b3a;
  --accent:#9bbcff;
}

*{ box-sizing:border-box; }

html,body{
  margin:0;
  height:100%;
  background:
    radial-gradient(1200px 800px at 35% 20%, rgba(80,120,255,.18), transparent 55%),
    radial-gradient(900px 700px at 70% 75%, rgba(120,80,255,.12), transparent 55%),
    var(--bg);
  color:var(--text);
  font-family: system-ui,-apple-system,BlinkMacSystemFont;
}

.wrapper{
  min-height:100dvh;
  display:flex;
  justify-content:center;
  padding: env(safe-area-inset-top) 14px env(safe-area-inset-bottom);
}

.console{
  width:100%;
  max-width:720px;
  margin: 80px auto 60px;
  background:var(--panel);
  border-radius:18px;
  padding:24px 20px 18px;
  backdrop-filter: blur(14px);
  box-shadow: 0 30px 80px rgba(0,0,0,.55);
}

.log{
  min-height:160px;
  max-height:56vh;
  overflow:auto;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

.log.free{
  justify-content:flex-start;
}

.entry{
  white-space:pre-wrap;
  line-height:1.8;
  font-size:15px;
  margin:6px 0;
  transition: opacity .6s ease;
}

.entry.user{ color:var(--user); }
.entry.assistant{ color:var(--assistant); }
.entry.faded{ opacity:.35; }

.input-wrap{
  margin-top:18px;
}

input{
  width:100%;
  padding:14px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.22);
  color:var(--text);
  font-size:14px;
  outline:none;
  transition:border-color 1.2s ease, box-shadow 1.2s ease;
}

input::placeholder{
  color:rgba(160,168,187,.7);
}

input.accepted{
  border-color:rgba(155,188,255,.75);
  box-shadow: 0 0 0 2px rgba(155,188,255,.18);
}

.footer{
  margin-top:18px;
  padding-top:14px;
  border-top:1px solid rgba(37,43,58,0.9);
  font-size:12px;
  color:var(--muted);
  display:flex;
  justify-content:flex-end;
  gap:16px;
}

.footer a{
  color:var(--muted);
  text-decoration:none;
  border-bottom:1px solid rgba(160,168,187,.35);
}
.footer a:hover{
  border-bottom-color:rgba(160,168,187,.75);
}
</style>
</head>

<body>
<div class="wrapper">
  <div class="console">
    <div id="log" class="log"></div>

    <div class="input-wrap">
      <input id="input" placeholder="Write freely." autocomplete="off" disabled />
    </div>

    <div class="footer">
      <a href="/about.html">Back to About</a>
      <span>CELESTE v4.4A</span>
    </div>
  </div>
</div>

<script>
const API_ENDPOINT = "/api/celeste";
const log = document.getElementById("log");
const input = document.getElementById("input");

function intro(){
  const e = document.createElement("div");
  e.className = "entry assistant";
  e.textContent = "Hello, I’m Celeste.\n\nWrite freely.";
  log.appendChild(e);

  setTimeout(()=>{ e.style.opacity = "0"; },4000);
  setTimeout(()=>{
    e.remove();
    input.disabled = false;
    input.focus();
  },5400);
}

function addEntry(text, cls){
  const e = document.createElement("div");
  e.className = "entry " + cls;
  e.textContent = text;
  log.appendChild(e);
  fadeOld();
  return e;
}

function fadeOld(){
  const entries = [...log.children];
  if(entries.length < 6) return;
  entries.slice(0,-5).forEach(e=>e.classList.add("faded"));
}

async function send(){
  const msg = input.value.trim();
  if(!msg) return;

  input.value = "";
  input.classList.add("accepted");
  setTimeout(()=>input.classList.remove("accepted"),1400);

  log.classList.remove("free");
  addEntry(msg,"user");

  setTimeout(async ()=>{
    try{
      const r = await fetch(API_ENDPOINT,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ message: msg })
      });
      const d = await r.json();
      if(d.reply){
        log.classList.add("free");
        addEntry(d.reply,"assistant");
        log.scrollTop = log.scrollHeight;
      }
    }catch{}
  },900);
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    send();
  }
});

intro();
</script>
</body>
</html>
