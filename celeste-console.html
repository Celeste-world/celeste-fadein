<script>
async function sendMessage(text) {
  const res = await fetch("/api/celeste", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: text })
  });

  const data = await res.json();

  if (data.state === "empty") {
    return ""; // 何も返さない（沈黙）
  }

  const lang = data.language;
  const depth = data.resonanceMax;

  // 解釈レイヤー（生成しない・装飾だけ）
  if (lang === "ja") {
    if (depth < 0.4) {
      return "少し置いてみてもいいかもしれません。";
    } else {
      return "今の言葉、ここに置いておけます。急がなくて大丈夫です。";
    }
  }

  if (lang === "zh") {
    return depth < 0.4
      ? "可以先放在这里。"
      : "这些话可以先留在这里，不需要着急。";
  }

  // English default
  return depth < 0.4
    ? "You can leave that here for now."
    : "Those words can stay here for a while. There is no need to rush.";
}
</script>
