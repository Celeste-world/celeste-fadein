<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Celeste – Console</title>

<link rel="icon" href="/images/favicon.svg" type="image/svg+xml">

<style>
:root{
  --bg:#050811;
  --panel:#0b1020cc;
  --border:#1b2540;
  --text:#e8ebef;
  --muted:#a9b3c7;
  --accent:#9bbcff;
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  background:
    radial-gradient(1200px 800px at 35% 20%, rgba(80,120,255,.18), transparent 55%),
    var(--bg);
  color:var(--text);
  font-family: ui-serif, Georgia, "Times New Roman", serif;
  padding:60px 20px 80px;
}
.wrap{width:min(760px,100%)}

.panel{
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));
  border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius);
  padding:24px;
}

.log{
  display:flex;
  flex-direction:column;
  gap:18px;
}

.turn{
  white-space:pre-wrap;
  line-height:1.7;
  font-size:16px;
}

.turn.user{color:var(--accent)}
.turn.assistant{color:var(--text)}

.intro{
  opacity:0;
  transition:opacity 2.4s ease;
}
.intro.show{opacity:1}
.intro.hide{opacity:0}

.input-wrap{
  margin-top:24px;
}
input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.28);
  color:var(--text);
  font-size:15px;
  outline:none;
  transition:border-color .9s ease;
}
input.received{
  border-color:var(--accent);
}
footer{
  margin-top:14px;
  font-size:12px;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
}
footer a{color:var(--accent);text-decoration:none}
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">
    <div id="log" class="log"></div>

    <div class="input-wrap">
      <input id="input" placeholder="Write freely." autocomplete="off">
    </div>

    <footer>
      <a href="/about.html">Back to About</a>
      <span>CELESTE v4.4A</span>
    </footer>
  </div>
</div>

<script>
const API = "/api/celeste";
const log = document.getElementById("log");
const input = document.getElementById("input");

/* ===== utility ===== */
const sleep = ms => new Promise(r=>setTimeout(r,ms));
const validText = s => /[A-Za-z0-9\u3040-\u30FF\u4E00-\u9FFF]/.test(s);

/* ===== intro ===== */
const intro = document.createElement("div");
intro.className="turn assistant intro";
intro.textContent="You can simply let your words appear.";
log.appendChild(intro);
requestAnimationFrame(()=>intro.classList.add("show"));
setTimeout(()=>{
  intro.classList.remove("show");
  intro.classList.add("hide");
  setTimeout(()=>intro.remove(),1400);
},3600);

/* ===== turn handling ===== */
function addTurn(text,role){
  const d=document.createElement("div");
  d.className=`turn ${role}`;
  d.textContent=text;
  log.appendChild(d);
  d.scrollIntoView({behavior:"smooth",block:"center"});
}

/* ===== send ===== */
async function send(){
  const raw=input.value;
  const msg=raw.trim();

  // 無効入力は完全無視
  if(!msg || !validText(msg)){
    input.value="";
    return;
  }

  addTurn(msg,"user");
  input.value="";
  input.disabled=true;

  // 枠の反応
  input.classList.add("received");
  await sleep(900);

  try{
    const r=await fetch(API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:msg})
    });
    const j=await r.json();
    if(j.reply){
      addTurn(j.reply,"assistant");
    }
  }catch(e){}
  finally{
    input.classList.remove("received");
    input.disabled=false;
    input.focus();
  }
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    send();
  }
});
</script>
</body>
</html>
