<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Celeste Console – Dev</title>

<style>
  body {
    margin: 0;
    background: radial-gradient(ellipse at top, #0b1530, #02040a);
    color: #e6ebff;
    font-family: "Georgia", serif;
  }

  .wrapper {
    max-width: 820px;
    margin: 80px auto;
    padding: 0 20px;
  }

  .console {
    border: 1px solid rgba(160,180,255,0.25);
    border-radius: 14px;
    padding: 28px;
    transition: border-color 0.6s ease;
  }

  .console.p1 {
    border-color: rgba(170,190,255,0.45);
  }
  .console.p2 {
    border-color: rgba(200,210,255,0.7);
  }
  .console.p3 {
    border-color: rgba(230,235,255,0.95);
  }

  .log {
    min-height: 240px;
    white-space: pre-wrap;
    line-height: 1.8;
  }

  .user {
    color: #9fb6ff;
    margin-bottom: 10px;
  }

  .reply {
    margin-bottom: 18px;
  }

  .guide {
    text-align: center;
    opacity: 0;
    transition: opacity 0.4s ease;
    margin: 12px 0 20px;
    font-size: 0.9rem;
    color: #b8c3ff;
  }

  .guide.show {
    opacity: 1;
  }

  .input-area {
    margin-top: 20px;
  }

  input {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid rgba(150,170,255,0.35);
    background: transparent;
    color: #e6ebff;
    font-size: 1rem;
  }

  input:focus {
    outline: none;
    border-color: rgba(200,220,255,0.8);
  }
</style>
</head>

<body>
<div class="wrapper">
  <div id="console" class="console">
    <div id="guide" class="guide">ここに自由に書けます</div>
    <div id="log" class="log"></div>

    <div class="input-area">
      <input id="input" placeholder="Write freely." />
    </div>
  </div>
</div>

<script>
const input = document.getElementById("input");
const log = document.getElementById("log");
const guide = document.getElementById("guide");
const consoleBox = document.getElementById("console");

let guideShown = false;

input.addEventListener("keydown", async (e) => {
  if (e.key !== "Enter") return;

  const text = input.value.trim();
  if (!text) return;

  input.value = "";

  log.innerHTML += `<div class="user">${text}</div>`;

  const res = await fetch("/api/celeste-dev", {
    method: "POST",
    body: JSON.stringify({ message: text }),
  });

  const data = await res.json();

  const pressure = data.pressure ?? 2;
  const reply = data.reply ?? "";

  // 枠反応
  consoleBox.classList.remove("p1","p2","p3");
  if (pressure >= 1) consoleBox.classList.add("p1");
  if (pressure >= 2) consoleBox.classList.add("p2");
  if (pressure >= 3) consoleBox.classList.add("p3");

  // 注意書き（1回だけ）
  if (!guideShown && pressure >= 1) {
    guide.classList.add("show");
    guideShown = true;

    setTimeout(() => {
      guide.style.opacity = "0";
    }, 1400);

    setTimeout(() => {
      guide.remove();
    }, 2200);
  }

  // 返事は必ず表示
  if (reply) {
    log.innerHTML += `<div class="reply">${reply}</div>`;
  }

  log.scrollTop = log.scrollHeight;
});
</script>
</body>
</html>
