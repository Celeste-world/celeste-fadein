<script>
const log   = document.getElementById("log");
const input = document.getElementById("input");

function addEntry(text, cls){
  if(!text) return;
  const div = document.createElement("div");
  div.className = "entry " + cls;
  div.textContent = text;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

function send(){
  const value = input.value.trim();
  if(!value) return;

  addEntry(value, "user");
  input.value = "";
  input.style.height = "auto";

  fetch("/api/celeste", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ message:value })
  })
  .then(res => res.json())
  .then(data => {
    if(data.reply){
      addEntry(data.reply, "celeste");
    }
  })
  .catch(()=>{});
}

/* Enter = send / Shift+Enter = newline */
input.addEventListener("keydown", e => {
  if(e.key === "Enter" && !e.shiftKey){
    e.preventDefault();
    send();
  }
});

/* auto resize */
input.addEventListener("input", () => {
  input.style.height = "auto";
  input.style.height = input.scrollHeight + "px";
});
</script>
