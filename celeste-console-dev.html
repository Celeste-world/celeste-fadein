<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Celeste Console – Dev</title>

<style>
  :root {
    --bg: #050811;
    --panel: #0c1220;
    --border: rgba(140,160,255,0.25);
    --border-active: rgba(140,160,255,0.6);
    --text: #e6ebff;
    --muted: rgba(230,235,255,0.55);
  }

  html, body {
    margin: 0;
    height: 100%;
    background: radial-gradient(circle at top, #0a1030, #03040a 70%);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    color: var(--text);
  }

  .wrap {
    display: flex;
    justify-content: center;
    padding: 64px 16px;
  }

  .console {
    width: 100%;
    max-width: 720px;
    background: linear-gradient(180deg, #0b1025, #070b18);
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 0 0 1px var(--border);
    transition: box-shadow 0.6s ease;
  }

  .console.active {
    box-shadow: 0 0 0 1px var(--border-active);
  }

  .log {
    white-space: pre-wrap;
    line-height: 1.7;
    margin-bottom: 18px;
  }

  .log .user {
    color: #9fb4ff;
    margin-bottom: 6px;
  }

  .log .reply {
    color: var(--text);
    margin-bottom: 14px;
  }

  .input-wrap {
    position: relative;
  }

  input {
    width: 100%;
    box-sizing: border-box;
    padding: 14px 16px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #060a16;
    color: var(--text);
    font-size: 16px;
    outline: none;
    transition: border-color 0.4s ease;
  }

  input:focus {
    border-color: var(--border-active);
  }

  .hint {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--muted);
    font-size: 14px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.6s ease;
  }

  .hint.show {
    opacity: 1;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="console" id="console">
    <div class="log" id="log"></div>
    <div class="input-wrap">
      <input id="input" placeholder="Write freely." autocomplete="off" />
    </div>
  </div>
</div>

<div class="hint" id="hint">ここは自由に書けます</div>

<script>
const input = document.getElementById("input");
const log = document.getElementById("log");
const hint = document.getElementById("hint");
const consoleBox = document.getElementById("console");

let hintShown = false;

function getPressure(text) {
  const t = text.trim();
  if (t.length === 0) return 0;
  if (t.length <= 2) return 1;
  return 2;
}

function showHint() {
  if (hintShown) return;
  hintShown = true;
  hint.classList.add("show");
  setTimeout(() => {
    hint.style.transition = "opacity 1.2s ease";
    hint.classList.remove("show");
  }, 1400);
}

function addLine(cls, text) {
  const div = document.createElement("div");
  div.className = cls;
  div.textContent = text;
  log.appendChild(div);
}

input.addEventListener("keydown", async (e) => {
  if (e.key !== "Enter") return;

  const text = input.value;
  input.value = "";

  const pressure = getPressure(text);

  addLine("user", text);

  if (pressure >= 1) {
    consoleBox.classList.add("active");
    showHint();
    setTimeout(() => consoleBox.classList.remove("active"), 1800);
  }

  if (pressure === 1) {
    addLine("reply", text);
    return;
  }

  if (pressure === 0) return;

  try {
    const res = await fetch("/functions/api/celeste-dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text })
    });

    const data = await res.json();
    if (data.reply) {
      addLine("reply", data.reply);
    }
  } catch (err) {
    console.error("API error", err);
  }
});
</script>
</body>
</html>
