<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Celeste Console – Dev (Contextual)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
<script>
const WORKER_URL = "https://celeste-worker-dev.inbox-celeste-world.workers.dev/";
const MAX_CONTEXT_LINES = 5;

const history = [];

async function sendMessage(text) {
  if (!text.trim()) return;

  history.push({ role: "user", text });
  if (history.length > MAX_CONTEXT_LINES) history.shift();

  const bundledMessage = history
    .map(h => h.text)
    .join("\n");

  const res = await fetch(WORKER_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: bundledMessage })
  });

  const data = await res.json();
  const reply = data.reply || "";

  if (reply) {
    history.push({ role: "assistant", text: reply });
    if (history.length > MAX_CONTEXT_LINES) history.shift();
  }

  render(reply);
}

function render(text) {
  console.log(text);
  // 既存の描画処理がある場合はここに接続
}
</script>
</body>
</html>
