<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Celeste Console – Dev</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#050811;
  color:#e8ebef;
  font-family: "Georgia", serif;
}

.wrapper{
  min-height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.console{
  width:800px;
  max-width:90%;
  padding:32px;
  border-radius:14px;
  background:rgba(15,20,40,.65);
  border:1px solid rgba(160,180,255,.15);
  transition: border-color .4s, box-shadow .4s;
}

.console.pressure1{
  border-color:rgba(160,180,255,.4);
  box-shadow:0 0 18px rgba(120,150,255,.15);
}

.console.pressure2{
  border-color:rgba(200,220,255,.7);
  box-shadow:0 0 28px rgba(160,190,255,.25);
}

.log{
  white-space:pre-wrap;
  min-height:180px;
}

.notice{
  margin-top:12px;
  font-size:.9em;
  opacity:.75;
  text-align:center;
}

.input{
  margin-top:24px;
}

input{
  width:100%;
  padding:14px;
  background:transparent;
  border:1px solid rgba(160,180,255,.3);
  border-radius:10px;
  color:#e8ebef;
  font-size:1em;
}
</style>
</head>

<body>
<div class="wrapper">
  <div class="console" id="console">
    <div class="log" id="log"></div>
    <div class="notice" id="notice"></div>
    <div class="input">
      <input id="input" placeholder="Write freely." autocomplete="off" />
    </div>
  </div>
</div>

<script>
const input   = document.getElementById("input");
const log     = document.getElementById("log");
const notice  = document.getElementById("notice");
const box     = document.getElementById("console");

function setPressure(level){
  box.className = "console" + (level ? " pressure"+level : "");
}

async function callAPI(text){
  const res = await fetch(
    "https://celeste.world/functions/api/celeste-dev",
    {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ text })
    }
  );

  if(!res.ok){
    throw new Error("API error "+res.status);
  }
  const data = await res.json();
  return data.reply || "";
}

input.addEventListener("keydown", async e=>{
  if(e.key !== "Enter") return;

  const text = input.value.trim();
  input.value = "";

  if(!text) return;

  log.textContent += text + "\n";

  const len = text.length;

  // pressure1：1〜2文字
  if(len <= 2){
    setPressure(1);
    notice.textContent = "短い言葉も、ここでは十分です。";
    log.textContent += text + "\n";
    setTimeout(()=>setPressure(0),1400);
    return;
  }

  // pressure2：3文字以上
  setPressure(2);
  notice.textContent = "この空間は、考えをそのまま置けます。";

  try{
    const reply = await callAPI(text);
    log.textContent += reply + "\n";
  }catch(err){
    log.textContent += "……\n";
  }

  setTimeout(()=>{
    setPressure(0);
    notice.textContent = "";
  },1400);
});
</script>
</body>
</html>
