<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Celeste Console – Dev</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root{
  --bg:#050811;
  --panel:#0c1324;
  --border:rgba(120,140,200,.25);
  --accent:rgba(140,170,255,.7);
  --text:#e8ebef;
}

html,body{
  margin:0;
  height:100%;
  background:radial-gradient(ellipse at top,#0b1635,#050811 70%);
  color:var(--text);
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
}

main{
  max-width:820px;
  margin:0 auto;
  padding:80px 20px;
}

.console{
  background:linear-gradient(180deg,#0c1324,#070c1a);
  border:1px solid var(--border);
  border-radius:18px;
  padding:28px;
  transition:border-color .4s, box-shadow .4s;
}

.console.pressure-1{ border-color:rgba(140,170,255,.45); }
.console.pressure-2{ border-color:rgba(170,200,255,.7); }
.console.pressure-3{
  border-color:rgba(200,220,255,.95);
  box-shadow:0 0 22px rgba(200,220,255,.25);
}

#log{
  min-height:180px;
  white-space:pre-wrap;
  line-height:1.7;
}

.user{ color:#9fb5ff; margin-bottom:6px; }
.reply{ color:#ffffff; margin-bottom:16px; }

.notice{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  opacity:0;
  transition:opacity .8s;
  font-size:15px;
  color:#cfd7ff;
}

.notice.show{ opacity:1; }

input{
  width:100%;
  margin-top:18px;
  padding:14px 16px;
  border-radius:12px;
  background:#050811;
  border:1px solid var(--border);
  color:var(--text);
  font-size:15px;
}
input:focus{
  outline:none;
  border-color:var(--accent);
}
</style>
</head>

<body>
<main>
  <div id="console" class="console">
    <div id="log"></div>
    <input id="input" placeholder="Write freely." />
  </div>
</main>

<div id="notice" class="notice">ここは自由に書けます</div>

<script>
const input = document.getElementById("input");
const log = document.getElementById("log");
const box = document.getElementById("console");
const notice = document.getElementById("notice");

function setPressure(p){
  box.className = "console pressure-" + p;
}

function showNotice(){
  notice.classList.add("show");
  setTimeout(()=>notice.classList.remove("show"),1400);
}

async function send(text){
  const len = [...text].length;

  // pressure 定義（あなたの最終案）
  let pressure = 0;
  if(len===0) pressure = 0;
  else if(len<=2) pressure = 1;
  else if(len<=60) pressure = 2;
  else pressure = 3;

  setPressure(pressure);
  if(pressure>=1) showNotice();

  log.innerHTML += `<div class="user">${text}</div>`;

  // pressure 1：単語返し
  if(pressure===1){
    log.innerHTML += `<div class="reply">${text}</div>`;
    return;
  }

  try{
    const res = await fetch(
      "/functions/api/celeste-dev?q=" + encodeURIComponent(text)
    );
    const data = await res.json();
    if(data.reply){
      log.innerHTML += `<div class="reply">${data.reply}</div>`;
    }
  }catch(e){
    console.error(e);
  }
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    const v = input.value.trim();
    input.value="";
    if(v) send(v);
  }
});
</script>
</body>
</html>
