<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Celeste Console â€“ Dev</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: radial-gradient(1200px 600px at 50% 0%, #0b1430, #050811);
  font-family: "Georgia", "Yu Mincho", serif;
  color: #e8ebef;
}

.wrapper {
  max-width: 820px;
  margin: 80px auto;
  padding: 0 20px;
}

.console {
  border: 1px solid rgba(180,200,255,0.35);
  border-radius: 14px;
  padding: 28px;
  background: rgba(10,20,45,0.45);
  transition: border-color 0.4s ease;
}

.console.pressure-1 { border-color: rgba(180,200,255,0.6); }
.console.pressure-2 { border-color: rgba(220,220,255,0.9); }
.console.pressure-3 { border-color: rgba(255,220,200,0.9); }

.log {
  white-space: pre-wrap;
  line-height: 1.8;
  min-height: 120px;
}

.notice {
  margin-top: 18px;
  text-align: center;
  font-size: 0.9em;
  color: rgba(200,210,255,0.65);
  opacity: 0;
  transition: opacity 0.4s ease;
}
.notice.show { opacity: 1; }

.input-box {
  margin-top: 24px;
}

input {
  width: 100%;
  padding: 14px 16px;
  border-radius: 10px;
  border: 1px solid rgba(180,200,255,0.35);
  background: rgba(0,0,0,0.25);
  color: #e8ebef;
  font-size: 1em;
}

input::placeholder {
  color: rgba(200,210,255,0.5);
}
</style>
</head>

<body>
<div class="wrapper">
  <div id="console" class="console">
    <div id="log" class="log"></div>

    <div id="notice" class="notice">
      This space is open to whatever you choose to write.
    </div>

    <div class="input-box">
      <input id="input" placeholder="Write freely." />
    </div>
  </div>
</div>

<script>
const input   = document.getElementById("input");
const log     = document.getElementById("log");
const notice  = document.getElementById("notice");
const consoleBox = document.getElementById("console");

function setPressure(p) {
  consoleBox.classList.remove("pressure-1","pressure-2","pressure-3");
  if (p >= 1) consoleBox.classList.add(`pressure-${p}`);
}

async function sendMessage(text) {
  const res = await fetch("/functions/api/celeste-dev", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: text })
  });

  const data = await res.json();
  return data;
}

input.addEventListener("keydown", async (e) => {
  if (e.key !== "Enter") return;

  const text = input.value.trim();
  if (!text) return;

  input.value = "";
  log.textContent += text + "\n";

  notice.classList.remove("show");

  try {
    const { reply, pressure } = await sendMessage(text);

    setPressure(pressure);

    if (pressure >= 1) {
      notice.classList.add("show");
    }

    if (reply) {
      setTimeout(() => {
        log.textContent += reply + "\n";
      }, 300);
    }

  } catch (err) {
    console.error(err);
  }
});
</script>
</body>
</html>
