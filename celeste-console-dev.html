<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>Celeste Console – Dev</title>

<style>
  body {
    margin: 0;
    background: radial-gradient(1200px 600px at 50% 0%, #0b1630, #050811);
    color: #e8ebef;
    font-family: "Georgia", serif;
  }

  .wrap {
    max-width: 860px;
    margin: 80px auto;
    padding: 0 24px;
  }

  .console {
    border: 1px solid rgba(180,200,255,.35);
    border-radius: 18px;
    padding: 28px;
    transition: border-color .4s, box-shadow .4s;
  }

  .console.pressure1 {
    border-color: rgba(200,220,255,.6);
    box-shadow: 0 0 18px rgba(180,200,255,.15);
  }

  .console.pressure2 {
    border-color: rgba(220,235,255,.9);
    box-shadow: 0 0 30px rgba(200,220,255,.35);
  }

  .log {
    min-height: 140px;
    white-space: pre-wrap;
    line-height: 1.6;
    margin-bottom: 24px;
  }

  .notice {
    text-align: center;
    font-size: 14px;
    opacity: .75;
    margin-bottom: 16px;
    display: none;
  }

  .notice.show {
    display: block;
  }

  textarea {
    width: 100%;
    height: 56px;
    resize: none;
    background: transparent;
    border: 1px solid rgba(180,200,255,.35);
    border-radius: 12px;
    padding: 14px;
    color: #e8ebef;
    font-size: 16px;
    outline: none;
  }

  footer {
    text-align: right;
    font-size: 12px;
    opacity: .5;
    margin-top: 12px;
  }
</style>
</head>

<body>
<div class="wrap">
  <div id="console" class="console">
    <div id="log" class="log"></div>
    <div id="notice" class="notice">This space is open to whatever you choose to write.</div>
    <textarea id="input" placeholder="Write freely."></textarea>
  </div>
  <footer>CELESTE v4.4-dev</footer>
</div>

<script>
const input   = document.getElementById("input");
const log     = document.getElementById("log");
const notice  = document.getElementById("notice");
const consoleBox = document.getElementById("console");

function setPressure(level) {
  consoleBox.classList.remove("pressure1","pressure2");
  if (level > 0) consoleBox.classList.add("pressure" + level);
}

function append(text) {
  log.textContent += text + "\n\n";
}

input.addEventListener("keydown", async (e) => {
  if (e.key !== "Enter") return;
  e.preventDefault();

  const text = input.value.trim();
  input.value = "";
  if (!text) return;

  append(text);

  const len = [...text].length;

  // ---- pressure 1 ----
  if (len <= 2) {
    setPressure(1);
    notice.classList.add("show");
    append(text);
    return;
  }

  // ---- pressure 2 ----
  setPressure(2);
  notice.classList.add("show");

  try {
    const res = await fetch("/functions/api/celeste-dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ q: text })
    });

    if (!res.ok) throw new Error("API error");

    const data = await res.json();
    append(data.reply);

  } catch (err) {
    append("…");
  }
});
</script>
</body>
</html>
